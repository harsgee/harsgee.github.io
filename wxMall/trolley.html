<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>微信商城-购物车</title>
    <link rel="stylesheet" href="dist/weui/weui.min.css">
    <link rel="stylesheet" href="dist/weui/jquery-weui.min.css">
    <script src="dist/weui/jquery-2.1.4.js"></script>
    <script src="dist/weui/swiper.min.js"></script>
    <link rel="stylesheet" href="css/wxMall.css">
    <script src="dist/weui/jquery-weui.min.js"></script>
    <script src="js/wxMall.js"></script>
</head>
<body>
<div class="page" style="padding: 0 0 50px;">
    <!--  排序 分类-->
    <div class="page-content">
        <div class="page-content_scroll">
            <div class="weui-cells" id="list">
                <div class="weui-cell">
                    <div class="cell-select">
                        <input type="checkbox" name="goods"/>
                    </div>
                    <div class="weui-cell__hd wx-mall_img">
                        <img src="image/ic_beijing.png" alt="">
                    </div>
                    <div class="weui-cell__bd wx-mall_content">
                        <p class="wx-mall_title">商品标题商品标题商品标题商品标题商品标题</p>
                        <div class="wx-mall_price">
                            <p class="now-price">&yen;<span>68</span></p>
                        </div>
                        <div class="wx-mall_heat">
                            <div class="selectedNum">
                                <span class="decrease">-</span>
                                <input type="text" value="1" readonly/>
                                <span class="increase">+</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weui-cell">
                    <div class="cell-select">
                        <input type="checkbox" name="goods"/>
                    </div>
                    <div class="weui-cell__hd wx-mall_img">
                        <img src="image/ic_beijing.png" alt="">
                    </div>
                    <div class="weui-cell__bd wx-mall_content">
                        <p class="wx-mall_title">商品标题商品标题商品标题商品标题商品标题</p>
                        <div class="wx-mall_price">
                            <p class="now-price">&yen;<span>68</span></p>
                        </div>
                        <div class="wx-mall_heat">
                            <div class="selectedNum">
                                <span class="decrease">-</span>
                                <input type="text" value="1" readonly/>
                                <span class="increase">+</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="trolley-bottom">
        <label class="allSelect"><input type="checkbox" name="allSelect"/>全选</label>
        <div class="deleteSelected">删除</div>
        <div class="total-cost"><span class="small-gray-text">合计：</span>&yen;<span class="price-num">0</span></div>
        <div class="toPay">去结算</div>
    </div>
    <div class="footer"></div>
</div>

<script>
    hyPage.foot('shopCart');
    window.onload = function () {

        //选择商品数量
        $('.increase').click(function () {
            var val = $(this).siblings('input').val();
            $(this).siblings('input').val(Number(val)+1);
            $('.total-cost').find('.price-num').text(getCost());
        });
        $('.decrease').click(function () {
            var val = $(this).siblings('input').val();
            if(val>1){
                $(this).siblings('input').val(Number(val)-1);
            }
            $('.total-cost').find('.price-num').text(getCost());
        });

        //全选
        $('input[name=allSelect]').click(function () {
            if($(this).prop('checked')){
                $('input[name=goods]').prop('checked',true);
                $('.deleteSelected').css({'display':'block'});
            }else {
                $('input[name=goods]').prop('checked',false);
                $('.deleteSelected').css({'display':'none'});
            }
            $('.total-cost').find('.price-num').text(getCost());
        });
        //单项选
        $('input[name=goods]').click(function () {
            var goodsSelect = $('input[name=goods]:checked').length;
            if(goodsSelect>0){
                $('.deleteSelected').css({'display':'block'});
            }else {
                $('.deleteSelected').css({'display':'none'});
            }
            if(goodsSelect==$('input[name=goods]').length){
                $('input[name=allSelect]').prop('checked',true);
            }else {
                $('input[name=allSelect]').prop('checked',false);
            }
            $('.total-cost').find('.price-num').text(getCost());
        });
        //选中商品  删除
        $('.deleteSelected').click(function () {
            $.confirm({
                title:'提示',
                text:'是否确定从购物车中删除选中商品？',
                onOK:function () {

                },
                onCancel:function () {
                    console.log('取消');
                }
            })
        });

//        去结算
        $('.toPay').click(function () {
            location.href = 'goodsConfirm.html';
        });

        function getCost() {
            var selected = $('input[name=goods]:checked');
            var cost = 0;
            var nprice = 0;
            var n = 0;
            for(var i=0;i<selected.length;i++){
                nprice = Number(selected.eq(i).parents('.weui-cell').find('.now-price').children('span').text());
                n = Number(selected.eq(i).parents('.weui-cell').find('.selectedNum').children('input').val());
                cost += n*nprice;
            }
            return cost;
        }
    }
</script>
</body>
</html>